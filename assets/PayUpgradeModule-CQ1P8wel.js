import{r as x,u as P,j as r,i as S,k as j}from"./index-CS7ZgHMT.js";import{o as k}from"./paddleUtils-Dzwv-Tny.js";const $=({email:I,isPopular:v,amountInNaira:w,planId:c,moduleKey:o,duration:a,onSuccess:u})=>{const[i,d]=x.useState(!1),[g,t]=x.useState(""),n=P(),y=async()=>{var m,p,b,h,f;try{d(!0),t("");const e=localStorage.getItem("authToken");e||(t("You need to be signed in to subscribe to a module."),setTimeout(()=>{n("/signin")},3e3)),console.log("Upgrade with:",{moduleKey:o,planId:c,duration:a});const s=(await S.post(`${j}subscriptions/upgrade/module`,{moduleKey:o,newPlanId:c,newDuration:a},{headers:{Authorization:e}})).data;s.success&&s.transactionId?await k(s.transactionId,{success:l=>{console.log("Payment successful:",l),u&&u({transactionId:s.transactionId,moduleKey:o,duration:a,amount:w})},error:l=>{console.error("Checkout error:",l),t("Payment failed. Please try again.")}}):t(s.error||"Failed to initiate subscription")}catch(e){if(console.error("Subscription error:",e),((m=e.response)==null?void 0:m.status)===401){localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),t("You need to be signed in to subscribe to a module."),setTimeout(()=>{n("/signin",{state:{message:"Your session has expired. Please sign in again."}})},3e3);return}if(t(((b=(p=e.response)==null?void 0:p.data)==null?void 0:b.error)||"Subscription failed. Please try again."),((f=(h=e==null?void 0:e.response)==null?void 0:h.data)==null?void 0:f.error)===`You already have an active subscription to the ${o} module`){setTimeout(()=>{n("/dashboard/overview/admin-organization")},3e3);return}}finally{d(!1)}};return r.jsxs("button",{onClick:y,disabled:i,className:`w-full py-3 px-6 rounded-lg font-semibold transition-all ${v?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700":"bg-gray-900 text-white hover:bg-gray-800"} ${i?"opacity-50 cursor-not-allowed":"hover:shadow-lg"}`,children:[i?r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):"Subscribe Now",g&&r.jsx("div",{className:"text-red-200 text-sm mt-1",children:g})]})};export{$ as P};
