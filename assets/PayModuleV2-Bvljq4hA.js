import{r as x,u as I,j as i,i as S,k as _}from"./index-C--zS8iv.js";import{i as N}from"./index.esm-CVZJPh_s.js";var k={VITE_PADDLE_CLIENT_TOKEN:"test_d26be2bbdec495f9c195fa2b6b6",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};let l=null;const T=async()=>{if(l)return l;try{return l=await N({environment:k.VITE_PADDLE_ENVIRONMENT||"sandbox",token:"test_d26be2bbdec495f9c195fa2b6b6"}),console.log("Paddle initialized successfully"),l}catch(a){throw console.error("Failed to initialize Paddle:",a),new Error("Payment system initialization failed")}},j=async(a,t={})=>{try{(await T()).Checkout.open({transactionId:a,success:t.success||(()=>console.log("Payment successful")),close:t.close||(()=>console.log("Checkout closed")),error:t.error||(c=>console.error("Checkout error:",c))})}catch(s){throw console.error("Failed to open checkout:",s),s}},L=({email:a,isPopular:t,amountInNaira:s,planId:c,moduleKey:n,duration:d,onSuccess:g})=>{const[u,h]=x.useState(!1),[p,o]=x.useState(""),b=I(),E=async()=>{var f,y,v,P,w;try{h(!0),o("");const e=localStorage.getItem("authToken");e||(o("You need to be signed in to subscribe to a module."),setTimeout(()=>{b("/signin")},3e3)),console.log("Subscribing with:",{moduleKey:n,duration:d});const r=(await S.post(`${_}subscriptions/subscribe/module`,{moduleKey:n,planId:c,duration:d},{headers:{Authorization:e}})).data;r.success&&r.transactionId?await j(r.transactionId,{success:m=>{console.log("Payment successful:",m),g&&g({transactionId:r.transactionId,moduleKey:n,duration:d,amount:s})},error:m=>{console.error("Checkout error:",m),o("Payment failed. Please try again.")}}):o(r.error||"Failed to initiate subscription")}catch(e){if(console.error("Subscription error:",e),((f=e.response)==null?void 0:f.status)===401){localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),o("You need to be signed in to subscribe to a module."),setTimeout(()=>{b("/signin",{state:{message:"Your session has expired. Please sign in again."}})},3e3);return}if(o(((v=(y=e.response)==null?void 0:y.data)==null?void 0:v.error)||"Subscription failed. Please try again."),((w=(P=e==null?void 0:e.response)==null?void 0:P.data)==null?void 0:w.error)===`You already have an active subscription to the ${n} module`){setTimeout(()=>{b("/dashboard/overview/admin-organization")},3e3);return}}finally{h(!1)}};return i.jsxs("button",{onClick:E,disabled:u,className:`w-full py-3 px-6 rounded-lg font-semibold transition-all ${t?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700":"bg-gray-900 text-white hover:bg-gray-800"} ${u?"opacity-50 cursor-not-allowed":"hover:shadow-lg"}`,children:[u?i.jsxs("div",{className:"flex items-center justify-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):"Subscribe Now",p&&i.jsx("div",{className:"text-red-200 text-sm mt-1",children:p})]})};export{L as P};
