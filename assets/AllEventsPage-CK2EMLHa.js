import{r as o,u as I,j as e,i as c,k as x}from"./index-BDnvDzac.js";import{S as F,F as $}from"./Failure-wE0pqmP7.js";import{n as z}from"./nodata-DkGH1G46.js";import{L as B}from"./loader-circle-DIwTOcaX.js";import"./check-B5zbgWYA.js";import"./x-DCGNCAok.js";const T=()=>{const[d,N]=o.useState([]),[b,h]=o.useState([]),[k,i]=o.useState(!0),[m,u]=o.useState(null),[p,g]=o.useState(""),[w,f]=o.useState(!1),[v,j]=o.useState(!1),[S,y]=o.useState(null),E=I();o.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("authToken");if(!s){u("User not authenticated"),i(!1);return}const[a,r]=await Promise.all([c.get(`${x}users/me/my-group-events`,{headers:{Authorization:s}}),c.get(`${x}users/event-bookings/my`,{headers:{Authorization:s}})]);console.log("Events Response:",a.data),N(a.data.events||[]);const l=r.data.bookings.map(n=>typeof n.eventId=="object"?n.eventId._id:n.eventId);h(l),i(!1)}catch(s){console.error("Error loading data:",s),u("Failed to load events"),i(!1)}})()},[]);const L=async(t,s)=>{var a,r;y(s);try{const l=localStorage.getItem("authToken");await c.post(`${x}events/${t}/${s}/book`,{},{headers:{Authorization:l}}),g("Booking successful"),f(!0),h(n=>[...n,s])}catch(l){j(!0),g(((r=(a=l.response)==null?void 0:a.data)==null?void 0:r.message)||"Failed to book event.")}finally{y(null)}};return k?e.jsx("div",{className:"p-4",children:"Loading events..."}):m?e.jsx("div",{className:"p-4 text-red-500",children:m}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"font-kanit text-lg font-semibold text-gray-800 mb-4",children:"Organizations Events"}),d.length===0?e.jsx("div",{className:"flex justify-center items-center w-full h-full",children:e.jsx("img",{src:z,className:"md:w-1/2 w-full",alt:"No data"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100",children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Logo"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Organization"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Title"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Location"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Link"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Price"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs",children:"Action"})]})}),e.jsx("tbody",{children:d.map(t=>{const s=b.includes(t._id),a=S===t._id;return e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2 text-xs",children:e.jsx("img",{src:t.organizationId.logoUrl,alt:"Logo",className:"w-10 h-10 object-contain rounded"})}),e.jsx("td",{className:"px-4 py-2 text-xs",children:t.organizationId.name}),e.jsx("td",{className:"px-4 py-2 text-xs",children:t.title}),e.jsx("td",{className:"px-4 py-2 text-xs",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-2 text-xs",children:t.location}),e.jsx("td",{className:"px-4 py-2 text-xs",children:e.jsx("a",{href:t.externalLink,className:"text-blue-600 underline",target:"_blank",rel:"noopener noreferrer",children:"Link"})}),e.jsx("td",{className:"px-4 py-2 text-xs",children:t.price>0?`$${t.price}`:"Free"}),e.jsxs("td",{className:"flex justify-start items-center flex-row gap-2 px-4 py-2 text-xs space-x-2",children:[e.jsx("button",{onClick:()=>L(t.organizationId._id,t._id),className:`px-3 py-1 rounded transition flex items-center justify-center gap-1 text-xs ${s?"bg-gray-400 text-white cursor-not-allowed":a?"bg-blue-300 text-white cursor-wait":"bg-blue-600 text-white hover:bg-blue-700"}`,disabled:s||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 animate-spin"}),"Booking..."]}):s?"Booked":"Book"}),e.jsx("button",{onClick:()=>E(`/dashboard/all-events/event-details/${t._id}`),className:"px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700",children:"View"})]})]},t._id)})})]})})]}),w&&e.jsx(F,{message:p,onClose:()=>f(!1)}),v&&e.jsx($,{message:p,onClose:()=>j(!1)})]})};export{T as default};
