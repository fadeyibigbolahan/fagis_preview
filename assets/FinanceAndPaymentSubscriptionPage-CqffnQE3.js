import{r as o,i as R,k as W,j as e,W as L,a as A,u as ue,L as ge,B as he,b as fe}from"./index-CS7ZgHMT.js";import{i as pe}from"./index.esm-CVZJPh_s.js";import{P as ye}from"./PayUpgradeModule-CQ1P8wel.js";import{X as je}from"./x-Dwv1eVjA.js";import{C as ee}from"./check-Duj1-6fA.js";import{B as be}from"./building-2-BawgBUey.js";import{T as D}from"./triangle-alert-C_lKQqhF.js";import{C as we}from"./chevron-up-Cgd-W5_r.js";import{C as Ne}from"./chevron-down-CFf_ZmAL.js";import{R as ve}from"./refresh-cw-CX5PqqV6.js";import{T as Pe}from"./trending-up-D-vg3JcM.js";import"./paddleUtils-Dzwv-Tny.js";const Ce=({isOpen:x,onClose:y,currentPlan:s,moduleKey:N="finance-payment",onUpgradeSuccess:C})=>{const[S,f]=o.useState([]),[u,p]=o.useState(!0);o.useState(null);const[d,$]=o.useState("1");o.useEffect(()=>{x&&z()},[x]);const z=async()=>{try{const n=localStorage.getItem("authToken"),l=await R.get(`${W}module-plans?moduleKey=${N}`,{headers:{Authorization:n}});f(l.data.data),p(!1)}catch(n){console.error("Failed to fetch plans:",n),p(!1)}},j=n=>{const l=[],r=n.features||{};return r.maxOrganizationWallets&&l.push(`${r.maxOrganizationWallets==="unlimited"?"Unlimited":r.maxOrganizationWallets} organization wallets`),r.memberWalletSupport&&l.push("Member wallet support"),r.automatedBilling&&l.push("Automated billing"),r.multiOrganizationPaymentProcessing&&l.push("Multi-org payments"),r.customInvoicing&&l.push("Custom invoicing"),r.advancedFinancialReporting&&l.push("Advanced reporting"),r.paymentGateways&&l.push(`${r.paymentGateways==="unlimited"?"Unlimited":r.paymentGateways} payment gateways`),r.transactionLimit&&l.push(`${r.transactionLimit==="unlimited"?"Unlimited":r.transactionLimit} transactions/month`),l},k=n=>{switch(n==null?void 0:n.toLowerCase()){case"basic":return e.jsx(L,{className:"h-6 w-6"});case"pro":return e.jsx(A,{className:"h-6 w-6"});case"enterprise":return e.jsx(be,{className:"h-6 w-6"});default:return e.jsx(L,{className:"h-6 w-6"})}};return x?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between md:p-6 p-2 border-b",children:[e.jsx("h2",{className:"md:text-2xl text-lg font-bold text-gray-900",children:"Change Finance & Payment Plan"}),e.jsx("button",{onClick:y,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(je,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("div",{className:"relative",children:e.jsxs("select",{value:d,onChange:n=>$(n.target.value),className:"appearance-none bg-white border border-gray-300 rounded-lg px-6 py-3 pr-10 text-gray-900 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 shadow-sm cursor-pointer",children:[e.jsx("option",{value:"1",children:"1 Month"}),e.jsx("option",{value:"3",children:"3 Months"}),e.jsx("option",{value:"6",children:"6 Months"}),e.jsx("option",{value:"12",children:"12 Months"})]})})}),u?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:S.map(n=>{var w;const l=n.pricing[d]||0,r=d==="1"?l:(l/parseInt(d)).toFixed(2),g=j(n),b=n.package===s;return e.jsxs("div",{className:`relative border-2 rounded-xl p-6 transition-all ${b?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300 hover:shadow-lg"}`,children:[b&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"bg-blue-500 text-white px-3 py-1 rounded-full text-xs font-medium",children:"Current Plan"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4",children:k(n.package)}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 capitalize",children:n.package}),e.jsx("p",{className:"text-gray-600 mt-2",children:n.description})]}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsxs("div",{className:"flex items-baseline justify-center",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["$",r]}),e.jsx("span",{className:"text-gray-600 ml-2",children:"/month"})]}),d!=="1"&&e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["$",l," total"]})]}),e.jsxs("ul",{className:"space-y-3 mb-6",children:[g.slice(0,5).map((v,U)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(ee,{className:"h-5 w-5 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm text-gray-700",children:v})]},U)),g.length>5&&e.jsxs("li",{className:"text-sm text-gray-500",children:["+",g.length-5," more features"]})]}),!b&&e.jsx(ye,{email:(w=localStorage.getItem("authUser"))==null?void 0:w.email,amountInNaira:l,moduleKey:N,planId:n.package,duration:d,onSuccess:C,className:"w-full"})]},n._id)})})]})]})}):null},Se=({orgCount:x=0,walletCount:y=0})=>{var B,G,T,K,Y,_,q,X,H,J,Q,V,Z;const[s,N]=o.useState(null),[C,S]=o.useState(!0),[f,u]=o.useState(null),[p,d]=o.useState(x),[$,z]=o.useState(y),[j,k]=o.useState(!1),[n,l]=o.useState(!1),[r,g]=o.useState(!1),[b,w]=o.useState(!1),[v,U]=o.useState(null);ue(),o.useEffect(()=>{pe({environment:"sandbox",token:"test_d26be2bbdec495f9c195fa2b6b6"}).then(t=>{console.log("Paddle initialized:",t),U(t)}).catch(t=>{console.error("Failed to initialize Paddle:",t)})},[]),o.useEffect(()=>{d(x),z(y)},[x,y]);const se=()=>{w(!0)},te=t=>{console.log("Upgrade successful:",t),alert(`Successfully upgraded to ${t.planId} plan!`),F()},ae=async()=>{var t,a,i,h;if(s!=null&&s.moduleKey){l(!0),u(null);try{const c=localStorage.getItem("authToken"),P=await R.post(`${W}subscriptions/renew/module`,{moduleKey:s.moduleKey},{headers:{Authorization:c}});P.data.transactionId&&v?v.Checkout.open({transactionId:P.data.transactionId,successCallback:xe=>{console.log("Renewal successful:",xe),F()},closeCallback:()=>{console.log("Checkout closed")}}):u("Failed to initiate renewal. Please try again.")}catch(c){console.error("Renewal failed:",c);const P=((a=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:a.error)||((h=(i=c==null?void 0:c.response)==null?void 0:i.data)==null?void 0:h.message)||"Renewal failed. Please try again.";u(P)}finally{l(!1),g(!1)}}},I=()=>{u(null),g(!0)},ne=()=>{g(!1)},F=async()=>{var t,a;try{const i=localStorage.getItem("authToken"),h=await R.get(`${W}organizations/user-subscription/finance-payment`,{headers:{Authorization:i}});N(h.data),console.log("Finance Payment API Response:",h.data)}catch(i){console.error("Failed to fetch finance payment subscription:",i),u(((a=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:a.message)||"Error fetching subscription")}finally{S(!1)}};o.useEffect(()=>{F()},[]);const le=t=>{if(!t)return 0;const a=new Date,h=new Date(t)-a;return Math.ceil(h/(1e3*60*60*24))},re=t=>{switch(t==null?void 0:t.toLowerCase()){case"basic":return"from-gray-500 to-gray-700";case"pro":return"from-blue-500 to-blue-700";case"enterprise":return"from-purple-500 to-purple-700";default:return"from-blue-500 to-blue-700"}},ie=()=>{var a,i;const t=((i=(a=s==null?void 0:s.planDetails)==null?void 0:a.features)==null?void 0:i.maxOrganizationWallets)||0;return t>0?p/t*100:0},oe=()=>{var a,i;const t=((i=(a=s==null?void 0:s.planDetails)==null?void 0:a.features)==null?void 0:i.maxOrganizationWallets)||0;return t>0?$/t*100:0},ce=t=>(t==null?void 0:t.charAt(0).toUpperCase())+(t==null?void 0:t.slice(1))||"Basic",de=()=>{var t,a;return((a=(t=s==null?void 0:s.planDetails)==null?void 0:t.pricing)==null?void 0:a["1"])||0},me=()=>{var i;const t=[],a=((i=s==null?void 0:s.planDetails)==null?void 0:i.features)||{};return a.maxOrganizationWallets&&t.push(`${a.maxOrganizationWallets==="unlimited"?"Unlimited":a.maxOrganizationWallets} organization wallets`),a.memberWalletSupport&&t.push("Member wallet support"),a.automatedBilling&&t.push("Automated billing"),a.multiOrganizationPaymentProcessing&&t.push("Multi-org payments"),a.customInvoicing&&t.push("Custom invoicing"),a.advancedFinancialReporting&&t.push("Advanced reporting"),a.paymentGateways&&t.push(`${a.paymentGateways==="unlimited"?"Unlimited":a.paymentGateways} payment gateway${a.paymentGateways===1?"":"s"}`),a.transactionLimit&&t.push(`${a.transactionLimit==="unlimited"?"Unlimited":a.transactionLimit} transactions/month`),t};if(C)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})]})});if(f||!s)return e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 text-center",children:[e.jsx(D,{className:"h-12 w-12 text-red-400 mb-3"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"Subscription Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:f||"Failed to load subscription data"}),e.jsx(ge,{to:"/finance-payment",children:e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Get Started"})})]})});const m=le(s==null?void 0:s.nextBillingDate),M=ie();oe();const O=((G=(B=s==null?void 0:s.planDetails)==null?void 0:B.features)==null?void 0:G.maxOrganizationWallets)||0,E=s.isActive&&s.status==="active";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 bg-gradient-to-br ${re(s.package)} rounded-lg flex items-center justify-center flex-shrink-0`,children:e.jsx(L,{className:"h-5 w-5 md:h-6 md:w-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg md:text-xl font-semibold text-gray-900",children:[ce(s.package)," Plan"]}),e.jsxs("p",{className:"text-gray-600",children:["$",de(),"/month"]})]})]}),e.jsxs("div",{className:"text-left md:text-right",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Current Status"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs md:text-sm font-medium ${E?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:E?"Active":"Inactive"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{children:"Organization Wallets"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[p," of ",O]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${M>=80?"bg-red-500":M>=60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(M,100)}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500",children:[Math.max(O-p,0)," wallets remaining"]})]}),e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Next Billing"})]}),e.jsx("span",{className:"text-sm text-gray-600",children:s.nextBillingDate?new Date(s.nextBillingDate).toLocaleDateString():"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-base md:text-lg font-semibold ${m<=7?"text-red-600":m<=30?"text-yellow-600":"text-green-600"}`,children:m>0?`${m} days remaining`:"Expired"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Auto-renewal enabled"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{children:"Monthly Transactions"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["125 of"," ",((K=(T=s==null?void 0:s.planDetails)==null?void 0:T.features)==null?void 0:K.transactionLimit)||"Unlimited"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${125/(((_=(Y=s==null?void 0:s.planDetails)==null?void 0:Y.features)==null?void 0:_.transactionLimit)||1)>=.8?"bg-red-500":125/(((X=(q=s==null?void 0:s.planDetails)==null?void 0:q.features)==null?void 0:X.transactionLimit)||1)>=.6?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(125/(((J=(H=s==null?void 0:s.planDetails)==null?void 0:H.features)==null?void 0:J.transactionLimit)||1)*100,100)}%`}})})]}),e.jsxs("div",{className:"space-y-3 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:"Payment Gateways"})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:["2 of"," ",((V=(Q=s==null?void 0:s.planDetails)==null?void 0:Q.features)==null?void 0:V.paymentGateways)||"Unlimited"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-green-500 transition-all duration-300",style:{width:"100%"}})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("button",{className:"flex items-center justify-between w-full md:hidden p-3 bg-gray-50 rounded-lg",onClick:()=>k(!j),children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Plan Features"}),j?e.jsx(we,{className:"h-4 w-4"}):e.jsx(Ne,{className:"h-4 w-4"})]}),e.jsx("h4",{className:"hidden md:block text-sm font-medium text-gray-700 mb-2",children:"Plan Features"}),e.jsxs("div",{className:`${j?"block":"hidden"} md:block`,children:[e.jsx("div",{className:"flex flex-wrap gap-2 mt-2 md:mt-0",children:me().map((t,a)=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-blue-50 text-blue-700",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),t]},a))}),((Z=s.planDetails)==null?void 0:Z.description)&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:s.planDetails.description})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-3 mb-4",children:r?e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-blue-50 rounded-lg border border-blue-200 w-full",children:[e.jsx("span",{className:"text-sm text-blue-800 flex-1",children:"Confirm renewal?"}),e.jsx("button",{onClick:ae,disabled:n,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 disabled:opacity-50",children:n?"Processing...":"Yes"}),e.jsx("button",{onClick:ne,disabled:n,className:"px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:I,disabled:n||!(s!=null&&s.moduleKey),className:"flex items-center text-xs justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex-1 sm:flex-none disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Renew Plan"})]}),e.jsxs("button",{onClick:se,className:"flex items-center text-xs justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex-1 sm:flex-none",children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{children:"Change Plan"})]})]})}),m<=30&&!r&&e.jsxs("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[e.jsx(D,{className:"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-sm text-yellow-800 flex-1",children:[e.jsx("strong",{children:"Expiring Soon:"})," Your subscription"," ",m>0?`expires in ${m} day${m!==1?"s":""}.`:"has expired."," ","Renew now to avoid service interruption."]})]}),e.jsx("button",{onClick:I,disabled:n,className:"w-full sm:w-auto px-3 py-1 bg-yellow-600 text-white text-xs rounded hover:bg-yellow-700 transition-colors disabled:opacity-50",children:n?"Processing...":"Renew Now"})]}),f&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:f})})]}),e.jsx(Ce,{isOpen:b,onClose:()=>w(!1),currentPlan:s==null?void 0:s.package,moduleKey:s==null?void 0:s.moduleKey,onUpgradeSuccess:te})]})},Ee=()=>e.jsx("div",{className:"min-h-screen bg-white text-xs p-4",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx(Se,{})})});export{Ee as default};
