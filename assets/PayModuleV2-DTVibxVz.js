import{r as f,u as P,j as r,i as S,k as j}from"./index-DO2kdC5F.js";import{o as k}from"./paddleUtils-Dzwv-Tny.js";const $=({email:I,isPopular:x,amountInNaira:v,planId:w,moduleKey:o,duration:a,onSuccess:c})=>{const[i,u]=f.useState(!1),[d,s]=f.useState(""),n=P(),y=async()=>{var m,b,g,h,p;try{u(!0),s("");const e=localStorage.getItem("authToken");e||(s("You need to be signed in to subscribe to a module."),setTimeout(()=>{n("/signin")},3e3)),console.log("Subscribing with:",{moduleKey:o,duration:a});const t=(await S.post(`${j}subscriptions/subscribe/module`,{moduleKey:o,planId:w,duration:a},{headers:{Authorization:e}})).data;t.success&&t.transactionId?await k(t.transactionId,{success:l=>{console.log("Payment successful:",l),c&&c({transactionId:t.transactionId,moduleKey:o,duration:a,amount:v})},error:l=>{console.error("Checkout error:",l),s("Payment failed. Please try again.")}}):s(t.error||"Failed to initiate subscription")}catch(e){if(console.error("Subscription error:",e),((m=e.response)==null?void 0:m.status)===401){localStorage.removeItem("authToken"),localStorage.removeItem("authUser"),s("You need to be signed in to subscribe to a module."),setTimeout(()=>{n("/signin",{state:{message:"Your session has expired. Please sign in again."}})},3e3);return}if(s(((g=(b=e.response)==null?void 0:b.data)==null?void 0:g.error)||"Subscription failed. Please try again."),((p=(h=e==null?void 0:e.response)==null?void 0:h.data)==null?void 0:p.error)===`You already have an active subscription to the ${o} module`){setTimeout(()=>{n("/dashboard/overview/admin-organization")},3e3);return}}finally{u(!1)}};return r.jsxs("button",{onClick:y,disabled:i,className:`w-full py-3 px-6 rounded-lg font-semibold transition-all ${x?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:from-blue-700 hover:to-purple-700":"bg-gray-900 text-white hover:bg-gray-800"} ${i?"opacity-50 cursor-not-allowed":"hover:shadow-lg"}`,children:[i?r.jsxs("div",{className:"flex items-center justify-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Processing..."]}):"Subscribe Now",d&&r.jsx("div",{className:"text-red-200 text-sm mt-1",children:d})]})};export{$ as P};
